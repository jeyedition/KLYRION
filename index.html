<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KLYRION</title>

<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- SPLASH -->
<div id="splash">
  <img src="logo.svg">
</div>

<!-- HEADER -->
<header>
  <h1>KLYRION</h1>
  <input id="search" placeholder="Buscar..." oninput="filter()">
  
</header>

<!-- CONTENIDO -->
<main id="content"></main>

<!-- NAVEGACIÓN -->
<nav>
  <button onclick="show('movies')">Películas</button>
  <button onclick="show('iptv')">IPTV</button>
</nav>

<!-- PLAYER -->
<div id="player">
  <video id="video" controls autoplay></video>
  <button onclick="closePlayer()">✖</button>
</div>

<!-- PRO -->
<div id="proBox">
  <div>
    <h3>Activar PRO</h3>
    <input id="proCode" placeholder="Código PRO">
    <button onclick="checkPro()">Activar</button>
  </div>
</div>

<script>
const DATA_URL = "data.json";
let DATA = {};
let CURRENT = [];
let IS_PRO = localStorage.getItem("pro") === "1";

/* SPLASH */
setTimeout(()=>{
  splash.style.display="none";
},2000);

/* CARGAR DATA */
async function loadData(){
  const r = await fetch(DATA_URL);
  DATA = await r.json();
  show("movies");
}

/* MOSTRAR SECCIÓN */
function show(type){
  CURRENT = DATA[type];
  render(CURRENT);
}

/* RENDER */
function render(list){
  content.innerHTML="";
  list.forEach(item=>{
    const locked = item.pro && !IS_PRO;
    const c = document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <img src="${item.img}">
      <span>${locked ? "PRO" : "▶ VER"}</span>
    `;
    c.onclick = ()=> locked ? openPro() : play(item.url);
    content.appendChild(c);
  });
}

/* BUSCADOR */
function filter(){
  const q = search.value.toLowerCase();
  render(
    CURRENT.filter(i =>
      (i.title || "").toLowerCase().includes(q)
    )
  );
}

/* PLAYER */
function play(url){
  player.style.display="flex";
  video.src=url;
}
function closePlayer(){
  video.pause();
  video.src="";
  player.style.display="none";
}

/* PRO */
function openPro(){
  proBox.style.display="flex";
}
function checkPro(){
  if(proCode.value==="KLYRION-PRO"){
    localStorage.setItem("pro","1");
    IS_PRO=true;
    proBox.style.display="none";
    show("movies");
    alert("PRO activado");
  }else{
    alert("Código incorrecto");
  }
}

loadData();
</script>

</body>
</html>
