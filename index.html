<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KLYRION TV</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<header class="topbar">
  <h1>KLYRION TV</h1>
  <button onclick="show('iptv')">EN VIVO</button>
  <button onclick="show('movies')">VOD</button>
  <button onclick="m3uInput.click()">IMPORTAR M3U</button>
</header>

<input type="file" id="m3uInput" accept=".m3u,.txt" hidden>

<main id="content"></main>

<script>
const DATA_URL = "data.json";
let DATA = {};
let CURRENT = [];

/* CARGA */
async function loadData(){
  const r = await fetch(DATA_URL);
  DATA = await r.json();
  show("iptv");
}

/* MOSTRAR */
function show(type){
  CURRENT = DATA[type] || [];
  render(CURRENT);
}

/* RENDER TIPO TV */
function render(list){
  content.innerHTML="";
  list.forEach(item=>{
    const card = document.createElement("div");
    card.className="tv-card";
    card.innerHTML=`
      <img src="${item.img}">
      <div class="tv-title">${item.title}</div>
    `;
    card.onclick = ()=> openExternal(item.url);
    content.appendChild(card);
  });
}

/* REPRODUCTOR EXTERNO */
function openExternal(url){
  window.location.href = url;
}

/* IMPORTAR M3U */
m3uInput.onchange = e =>{
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = ()=> parseM3U(reader.result);
  reader.readAsText(file);
};

function parseM3U(text){
  const lines = text.split("\n");
  const list = [];
  let name = "";
  lines.forEach(l=>{
    if(l.startsWith("#EXTINF")){
      name = l.split(",").pop().trim();
    }
    if(l.startsWith("http")){
      list.push({
        title: name || "Canal",
        img: "https://via.placeholder.com/320x180.webp",
        url: l.trim()
      });
    }
  });
  render(list);
}

loadData();
</script>

</body>
</html>
